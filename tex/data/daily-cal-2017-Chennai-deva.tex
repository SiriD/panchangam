% !Tex root = daily-cal-2015-Chennai-deva.tex
\documentclass[12pt]{article}
\usepackage[dvipsnames]{xcolor} 
\usepackage[paperwidth=126mm,paperheight=168mm,left=5mm,right=5mm,top=10mm,bottom=0mm]{geometry}
\usepackage[xetex]{graphicx}
\usepackage{array}
\usepackage{multirow}
\usepackage{pxfonts}
\usepackage{bbding}
\usepackage{wasysym} 
\usepackage{fontspec}
\usepackage{multicol}
\usepackage{supertabular}
\newcommand{\yearname}{2015}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% MOONPHASE CODE 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Credits: http://tex.stackexchange.com/questions/34785/how-to-typeset-moon-phase-symbols (Jake!)
\usepackage{tikz}
\usetikzlibrary{calendar,fpu}

\tikzset{
    moon colour/.style={
        moon fill/.style={
            fill=#1
        }
    },
    sky colour/.style={
        sky draw/.style={
            draw=#1
        },
        sky fill/.style={
            fill=#1
        }
    },
    southern hemisphere/.style={
        rotate=180
    }
}

\makeatletter
\pgfcalendardatetojulian{2010-01-15}{\c@pgf@counta} % 2010-01-15 07:11 UTC -- http://aa.usno.navy.mil/cgi-bin/aa_moonphases.pl?year=2010&ZZZ=END
\def\synodicmonth{29.530588853}
\newcommand{\moon}[2][]{%
    \edef\checkfordate{\noexpand\in@{-}{#2}}%
    \checkfordate%
    \ifin@%
        \pgfcalendardatetojulian{#2}{\c@pgf@countb}%
        \pgfkeys{/pgf/fpu=true,/pgf/fpu/output format=fixed}%
        \pgfmathsetmacro\dayssincenewmoon{\the\c@pgf@countb-\the\c@pgf@counta-(7/24+11/(24*60))}%
        \pgfmathsetmacro\lunarage{mod(\dayssincenewmoon,\synodicmonth)}
        \pgfkeys{/pgf/fpu=false}%%
    \else%
        \def\lunarage{#2}%
    \fi%
    \pgfmathsetmacro\leftside{ifthenelse(\lunarage<=\synodicmonth/2,cos(360*(\lunarage/\synodicmonth)),1)}%
    \pgfmathsetmacro\rightside{ifthenelse(\lunarage<=\synodicmonth/2,-1,-cos(360*(\lunarage/\synodicmonth))}%
    \tikz [moon colour=white,sky colour=black,#1]{
        \draw [moon fill, sky draw] (0,0) circle [radius=1ex];
        \draw [sky draw, sky fill] (0,1ex)
            arc (90:-90:\rightside ex and 1ex)
            arc (-90:90:\leftside ex and 1ex)
            -- cycle;
    }%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% END MOONPHASE CODE
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \setlength{\footskip}{0mm}
% PDF SETUP
% ---- FILL IN HERE THE DOC TITLE AND AUTHOR
\defaultfontfeatures{Scale=MatchLowercase,Mapping=tex-text}
\setmainfont{Siddhanta}[Script=Devanagari]
\setsansfont[Scale=0.8]{Noto Sans UI}
%%%%%%% Numbers and counters %%%%%%%
\newcount\num
\newcount\tempone \newcount\temptwo
\newcommand{\devanumber}[1]{%
\num=#1\devanumberrecurse}

\newcommand{\devanumberrecurse}{%
{\tempone=\num
%  \showthe\tempone\ %
\ifnum\num > 0 
	\divide \num by 10%
	\temptwo=\num \multiply\temptwo by -10%
	\devanumberrecurse%
% 	\\stage 2\ %
% 	\showthe\temptwo\ %
% 	temp1=\number\tempone\ %
% 	num=\number\num\ %
	\advance\tempone by \temptwo%
	\devadigit
\fi
}}
\newcommand{\devadigit}{%
\ifcase\tempone०\or१\or२\or३\or४\or५\or६\or७\or८\or९\fi%\number\tempone%
}
\newcommand{\eventsep}{~\raisebox{1pt}{\scriptsize$\Diamondblack$} }
\newcommand{\TO}{\hspace{1pt}\raisebox{1pt}{\footnotesize\RIGHTarrow}\hspace{1pt}}
%%%%%%%% Calendar display stuff %%%%%%%%%%%
\newcommand{\sunmonth}[6]{%
\begin{minipage}[t]{56mm}
\begin{minipage}[t]{\linewidth}
\centering
\large #6\\[1ex]%Samvatsara Name
{\LARGE #1}\\%Solar month name
\mbox{\small #3}\\[1ex]%Month end time, if any
#4\\[3ex]%Lunar month name
\end{minipage}
\begin{minipage}[c][30mm]{\linewidth}
\centering
 \mbox{\font\x="Siddhanta:script=deva" at 80 pt\x \devanumber{#2}}\mbox{}\\[2ex]%Solar month date
 \end{minipage}
 \begin{minipage}[b][14mm]{\linewidth}
 \centering
\mbox{\font\x="Siddhanta:script=deva" at 24 pt\x {#5}}\\%Vara name
\mbox{}
\end{minipage}
\end{minipage}%
}
\newcommand{\tamil}[1]{%
{\fontspec[Scale=0.9,FakeStretch=0.9]{Noto Sans Tamil} \footnotesize #1}}
\newcommand{\kalas}[6]{%
\centerline{\small{\mbox{प्रातः सन्ध्या \textsf{#1} सङ्गव \textsf{#2}\hspace{2ex}मध्याह्न \textsf{#3}{\scriptsize\RIGHTarrow}\textsf{#4}\hspace{2ex} सायाह्न \textsf{#5} सायं सन्ध्या \textsf{#6}}}}%Sangava kala etc
}
\newcommand{\sunmoondata}[5]{%
\mbox{\large\sun{\small\UParrow}\textsf{#1}~\sun{\small\DOWNarrow}\textsf{#2}}\hfill
\mbox{\large\rightmoon{\small\UParrow}\textsf{#3}~\rightmoon{\small\DOWNarrow}\textsf{#4}}\\
#5
 }
\newcommand{\tnykdata}[6]{\large
\mbox{#1}\\%Tithi
\mbox{नक्षत्रम्–#2}\hspace{2ex}\parbox[c][2em][c]{10mm}{\scriptsize(#3)} \\%Nakshatram and Rashi
\mbox{योगः–#4}\\%Yogam
करणम्–#5\\%Karanam
\parbox[c][2ex][c]{0.9\linewidth}{#6}
}
\newcommand{\rygdata}[3]{%
\begin{minipage}{\linewidth}
\centering
\rule{0.7\textwidth}{.4pt}
\small राहु~\textsf{#1}~~यम~\textsf{#2}~~गुलिक~\textsf{#3}%Rahu Yama Gulika
\end{minipage}
}
\newcommand{\caldata}[8]{%
\begin{minipage}[t]{56mm}
\centering
\large \textsf{\yearname}\\[1ex]%YYYY
 \mbox{\font\x="Ubuntu" at 16 pt\x {\uppercase{#1}}}\\[9ex]%mmm
 \mbox{\font\x="Ubuntu" at 80 pt\x #2}\\[3ex]%DD
\mbox{\font\x="Ubuntu" at 24 pt\x \uppercase{#8}}\\%Day of the week
\mbox{}
\end{minipage}
\vline
#3 %Right panel with all solar/lunar month data
\hrule
\mbox{}\\[0.3ex]
#4\\[0.5em]%Sun rise, kalas etc
#5\\[1.4em]%Tithi, Nakshatram, Varam, Yogam
\parbox[c][3em][c]{0.9\linewidth}{\centering\normalsize\textcolor{RoyalBlue}{#7}}\\\vfill%Festivals
#6%Rahu, Yama etc
\clearpage
}

\addtolength{\headsep}{-3ex}
\setlength\parindent{0pt}
\pagestyle{empty}
\begin{document}
\mbox{}
\renewcommand{\yearname}{2017}
\begin{center}
{\font\x="Noto Sans UI" at 60 pt\x 2017\\[0.5cm]}
\mbox{\font\x="Siddhanta:script=deva" at 48 pt\x दुर्मुखी–हेविलम्बी}\\[0.5cm]
\mbox{\font\x="Siddhanta:script=deva" at 32 pt\x कलि } %
{\font\x="Noto Sans UI" at 32 pt\x 5117–5118\\[0.5cm]}
{\font\x="Noto Sans UI" at 48 pt\x \uppercase{Chennai}\\[0.2cm]}
{\font\x="Noto Sans UI" at 16 pt\x {13°05'24''N, 80°16'12''E}\\[0.5cm]}
\hrule
\end{center}
\clearpage
\caldata{JANUARY}{1}{\sunmonth{धनुः}{17}{}{पौष}{भानु}{दुर्मुखी}}
{\sunmoondata{06:32}{17:52}{08:42}{20:36}
{\kalas{05:41}{08:48}{11:04}{13:20}{15:36}{17:07}}}
{\tnykdata{\mbox{\raisebox{-1pt}{\moon[scale=0.8]{3}}\hspace{2pt}शुक्ल-तृतीया\TO{}\textsf{15:33\hspace{2ex}}}}%
{\mbox{श्रवण\TO{}\textsf{16:01}}}{\mbox{मकर-राशी \RIGHTarrow \textsf{04:29(+1)}}}%
{\mbox{हर्षण\TO{}\textsf{09:26\hspace{2ex}}}}%
{\mbox{गरज\TO{}\textsf{15:33\hspace{2ex}}}\mbox{वणिज\TO{}\textsf{03:45(+1)\hspace{2ex}}}}{\tiny }
}
{\rygdata{16:27--17:52}{12:12--13:37}{15:02--16:27}}
{}
{Sun} 
\caldata{JANUARY}{2}{\sunmonth{धनुः}{18}{}{पौष}{इन्दु}{दुर्मुखी}}
{\sunmoondata{06:32}{17:53}{09:28}{21:28}
{\kalas{05:42}{08:48}{11:04}{13:21}{15:37}{17:07}}}
{\tnykdata{\mbox{\raisebox{-1pt}{\moon[scale=0.8]{4}}\hspace{2pt}शुक्ल-चतुर्थी\TO{}\textsf{15:50\hspace{2ex}}}}%
{\mbox{श्रविष्ठा\TO{}\textsf{16:51}}}{\mbox{कुम्भ-राशी}}%
{\mbox{वज्र\TO{}\textsf{08:33\hspace{2ex}}}}%
{\mbox{भद्र\TO{}\textsf{15:50\hspace{2ex}}}\mbox{बव\TO{}\textsf{03:50(+1)\hspace{2ex}}}}{\tiny }
}
{\rygdata{07:57--09:22}{10:47--12:12}{13:38--15:03}}
